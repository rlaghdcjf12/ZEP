<html style="overflow: hidden">

<head>
	<style type="text/css">
		.container {
			background-color: rgba(255, 255, 255, 0);
			font-size: min(14px, 3vmin);
		}

		#dialog {
			padding: 5px;

			background-color: rgb(255, 255, 255);

			font-size: 14px;
			color: black;
		}

		.dialogWrapper {
			padding: 20px;

			border: solid 3px dimgray;
			border-radius: 10px;
			background-color: white;
		}

		.noOption {
			margin-top: 30%;
		}

		header {
			display: flex;
		}

		h3 {
			margin: 0;
		}

		.closeButton {
			margin-left: auto;
			font-size: 20px;
			font-weight: 600;

			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none
		}

		.closeButton img {
			width: 24px;
			height: 24px;
		}

		.Box {
			width: 100%;
			display: flex;
			margin-top: 4px;
		}

		#options {
			width: 100%;
		}

		#optionGuide {
			width: 10%;
			height: 32px;

			line-height: 32px;
			font-weight: 600;
			text-align: center;
		}

		.option {
			width: 100%;
			height: 32px;
			margin-bottom: 4px;

			border: solid 1px #ccc;
			border-radius: 4px;
			background-color: #f3f2ff;

			line-height: 32px;
			font-size: min(14px, 3vw);
			color: black;
			text-align: center;
			overflow: hidden;
		}

		.option.selected {
			background-color: #e9e8ff;
			color: #6758ff;
		}

		#button {
			width: 72px;
			height: 32px;
			margin-left: auto;

			border: solid 1px white;
			border-radius: 4px;
			background-color: #6758ff;

			line-height: 32px;
			color: white;
			text-align: center;
		}

		.disable {
			background-color: #c0c0c0 !important;
		}
	</style>
</head>

<body>
	<div class="container">
		<div id="dialog" class="dialogWrapper">
			<header>
				<h3 id="name"></h3>
				<div onclick="javascript:handleCloseButton()" class="closeButton">
					<img src="https://zep.us/images/svg/close__icon.svg" />
				</div>
			</header>
			<p id="text"></p>
			<div id="optionBox" class="Box"></div>
			<div id="buttonBox" class="Box"></div>
		</div>
	</div>
	<script type="text/javascript">
		let condition, dialogFlow;
		let selectedOptionNo, selectedLink;

		window.addEventListener("message", (e) => {
			console.log('1 data : ', e.data)
			init(e.data);

			document.getElementById("name").innerText = dialogFlow[0].name;
			document.getElementById("text").innerText = dialogFlow[0].text;

			if (dialogFlow[0].options) {
				setOptions(0);
			}
		});

		const init = (data) => {
			console.log('2 data : ', data)
			condition = data.condition;
			dialogFlow = NPC_DIALOG_FLOW[data.id];
			selectedOptionNo = -1;
			selectedLink = -11;
		}

		const setOptions = (flowNo) => {
			document.getElementById("optionBox").innerHTML = `
				<div id="optionGuide">>></div>
				<div id="options"></div>`;
			document.getElementById("buttonBox").innerHTML = `
				<div id="button" class="disable" onclick="javascript:handleButton()">í™•ì¸</div>`;

			let Options = document.getElementById("options");
			Options.innerHTML = '';

			dialogFlow[flowNo].options.forEach(oi => {
				Options.innerHTML += `
					<button
						id="option${oi.number}"
						class="option"
						onclick="javascript:handleSelectOption(${oi.number}, ${oi.link})"
					>
						${oi.text}
					</button>`;
			});
		}

		const handleCloseButton = () => {
			window.parent.postMessage({ type: "closeDialog" }, "*");
		}

		const handleSelectOption = (optNo, link) => {
			selectedOptionNo = optNo;
			selectedLink = link;
			document.getElementById(`option${optNo}`).classList.add("selected");
			document.getElementById("button").classList.remove("disable");
		}

		const handleButton = () => {
			if (selectedLink == -1) {
				handleCloseButton();
			} else {
				document.getElementById("name").innerText = dialogFlow[selectedLink].name;
				document.getElementById("text").innerText = dialogFlow[selectedLink].text;

				if (dialogFlow[selectedLink].options) {
					setOptions(selectedLink);
				} else {
					document.getElementById("optionBox").classList.add('none');
				}
			}

			selectedOptionNo = -1;
			selectedLink = -11;
			document.getElementById("button").classList.add("disable");
		}
		

		const NPC_DIALOG_FLOW = {
			0: [ // ë‚˜
				{
					name: 'ë‚˜',
					text: 'ì´ì œ ê³§ 6ì‹œë„¤... í•œìŠ¤ ì´ ë†ˆì€ ë„ëŒ€ì²´ ì–´ë””ë¡œ ì‚¬ë¼ì§„ê±°ì•¼?? ì—°ë½ë„ ì•ˆë˜ê³ !\n'
						+ 'í™”ì‚´í‘œë¥¼ ë”°ë¼ ì´ë™í•´ë³´ì.',
				},
			],
			1: [ // ì•ˆë‚´ì›
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'ì•ˆë…•í•˜ì„¸ìš”~ ì´ ê²Œì„ì— ëŒ€í•´ì„œ ê°„ë‹¨íˆ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”!',
					options: [
						{ number: 0, text: 'ë„¤!', link: 1 },
					],
				},
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'ìš°ì„ , ì˜¤ë©´ì„œ ë³´ì…¨ê² ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ Zì™€ Fí‚¤ë¥¼ í†µí•œ í–‰ë™ì´ ìˆì–´ìš”. ì•ˆë‚´ì›ì—ê²Œ ë§ì„ ê±¸ê±°ë‚˜ ê²Œì´íŠ¸ë¥¼ ì—´ ë•Œ Fí‚¤ë¥¼ í†µí•´ ì…ì¥í–ˆì„ ê±°ì—ìš”.',
					options: [
						{ number: 0, text: 'ë„¤, ì²˜ìŒì´ë¼ ìµìˆ™ì¹˜ëŠ” ì•Šë„¤ìš”.', link: 2 },
					],
				},
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'ì•ì˜ ì•ˆë‚´ì›ì²˜ëŸ¼ ë§í’ì„  í˜•íƒœë¡œ ì´ì•¼ê¸°ë¥¼ í•˜ëŠ” ê²½ìš°ë„ ìˆê³ , ì§€ê¸ˆì²˜ëŸ¼ ê°€ìš´ë°ì— ì°½ì´ ì—´ë¦¬ëŠ” ëŒ€í™”ê°€ ìˆì–´ìš”.',
					options: [
						{ number: 0, text: 'ë„¤, ì•Œê² ìŠµë‹ˆë‹¤.', link: 3 },
					],
				},
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'ê²Œì„ì˜ ëª©í‘œëŠ” ì—°êµ¬ë™ 5ì¸µì—ì„œ 30ë¶„ ì•ˆì— í•œìŠ¤ë¥¼ ì°¾ëŠ” ê²ƒì´ê³ , ì¤‘ê°„ì¤‘ê°„ í•¨ì •ì´ë‚˜ ë¬¸ì œë“¤ì´ ìˆ¨ì–´ìˆì–´ìš”. ì´ê²ƒë“¤ì„ ì˜ ë§ì¶”ê³  í•´ê²°í•˜ë©´ì„œ ë‚˜ì˜¤ì‹œë©´ ë©ë‹ˆë‹¤.',
					options: [
						{ number: 0, text: 'ë„¤, í•´ë³´ê² ìŠµë‹ˆë‹¤.', link: 4 },
					],
				},
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'ì˜†ì— ê°€ì´ë“œë„ ìˆìœ¼ë‹ˆ, í•œ ë²ˆ í™•ì¸í•˜ê³  ê°€ì„¸ìš”~!',
					options: [
						{ number: 0, text: 'ë„¤!', link: 5 },
					],
				},
				{
					name: 'ê²Œì„ ì•ˆë‚´ì›',
					text: 'íŠ¹ë³„í•œ ìŠ¤íƒ¬í”„ë“¤ë„ ê³³ê³³ì— ìˆ¨ê²¨ë†¨ìœ¼ë‹ˆ, ì˜ ì°¾ì•„ë³´ì„¸ìš” ğŸ˜Š',
					options: [
						{ number: 0, text: 'ë„¤, ì•ˆë‚´ ê°ì‚¬í•©ë‹ˆë‹¤~', link: -1 },
					],
				},
			],
		};
	</script>
</body>

</html>
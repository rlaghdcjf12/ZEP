<html style="overflow: hidden">
	<head>
		<style type="text/css">
			.container {
				background-color: rgba(255, 255, 255, 0);
				font-size: 14px;
			}

			#dialog {
				height: 95%;
				padding: 5px;

				background-color: rgb(255, 255, 255);

				font-size: 14px;
				color: black;
			}

			.dialogWrapper {
				height: 100%;
				padding: 20px;

				border: solid 3px dimgray;
				border-radius: 10px;
				background-color: white;
			}

			.imageWrapper {
				width: min(80vw, 400px);
				height: min(80vw, 400px);

				margin: 0 auto;
			}

			.wide {
				width: min(88vw, 600px) !important;
				height: min(66vw, 450px) !important;
			}

			img {
				width: 100%;
				height: 100%;
			}

			.box {
				width: 100%;
				margin-top: 4px;
			}

			.flex {
				display: flex;
			}

			.onRight {
				margin-left: auto;
			}

			.button {
				width: 72px;
				height: 32px;

				border: solid 1px white;
				border-radius: 4px;
				background-color: #6758ff;

				line-height: 32px;
				color: white;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div id="dialog" class="dialogWrapper">
				<div id="imageBox"></div>
				<div class="flex box">
					<div class="flex onRight ">
						<div id="nextButton" class="button" onclick="javascript:nextImage()"></div>
						<div class="button" onclick="javascript:handleCloseButton()">확인</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			let isWide, condition, imageList, nextButtonText, imgNo, isChkLast, chkListNo;

			window.addEventListener("message", (e) => {
				isWide = e.data.isWide;
				condition =  e.data.player.tag.condition;
				imageList = IMAGE_FLOW[e.data.dialogId].imageList;
				nextButtonText = IMAGE_FLOW[e.data.dialogId].nextButtonText ? IMAGE_FLOW[e.data.dialogId].nextButtonText : '다음';
				chkListNo = IMAGE_FLOW[e.data.dialogId].chkListNo ? IMAGE_FLOW[e.data.dialogId].chkListNo : -1;

				init();
			});
			
			const setImage = (no) => {
				const IMG = `
					<div id="imageWrapper" class="imageWrapper">
						<img src="${imageList[no]}" alt="image"/>
					</div>`;
				document.getElementById('imageBox').innerHTML = IMG;
			}

			const init = () => {
				imgNo = 0;
				isChkLast = false;
				setImage(imgNo);
				if(imageList.length == 1)
					document.getElementById('nextButton').remove();
				else
					document.getElementById('nextButton').innerHTML = nextButtonText;
				
				if(isWide){
					document.getElementById('imageWrapper').classList.add('wide');
				}
			}

			const nextImage = () => {
				imgNo += 1;
				if (imgNo == imageList.length - 1)
					isChkLast = true;
				else if (imgNo >= imageList.length)
					imgNo = 0;

				setImage(imgNo);
			}

			const handleCloseButton = () => {
				if (isChkLast && chkListNo != -1)
					window.parent.postMessage({type: "setCheckList", listNo: chkListNo}, "*");
				else {
					window.parent.postMessage({type: "closeDialog"}, "*");
				}
			}

			const IMAGE_FLOW = {
				0: {	
					chkListNo: 3,
					nextButtonText: '뒤집기',
					imageList: [
						"https://github.com/rlaghdcjf12/ZEP/blob/main/seekHANSout/floor5/assets/hansCardOnToilet.jpg?raw=true",
						"https://github.com/rlaghdcjf12/ZEP/blob/main/seekHANSout/floor5/assets/hansCardMemo1.png?raw=true"]
				},
				100: {
					imageList: [
						"https://github.com/rlaghdcjf12/ZEP/blob/main/seekHANSout/floor5/assets/map.png?raw=true"]
				}
			}
		</script>
	</body>
</html>

<html style="overflow: hidden">
	<head>
		<style type="text/css">
			.container {
				background-color: rgba(255, 255, 255, 0);
				font-size: 14px;
			}

			#dialog {
				height: 95%;
				padding: 5px;

				background-color: rgb(255, 255, 255);

				font-size: 14px;
				color: black;
			}

			.dialogWrapper {
				height: 100%;
				padding: 20px;

				border: solid 3px dimgray;
				border-radius: 10px;
				background-color: white;
			}

			.imageWrapper {
				width: min(80vw, 400px);
				height: min(80vw, 400px);

				margin: 0 auto;
			}

			img {
				width: 100%;
				height: 100%;
			}

			.box {
				width: 100%;
				margin-top: 4px;
			}

			.flex {
				display: flex;
			}

			.onRight {
				margin-left: auto;
			}

			.button {
				width: 72px;
				height: 32px;

				border: solid 1px white;
				border-radius: 4px;
				background-color: #6758ff;

				line-height: 32px;
				color: white;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div id="dialog" class="dialogWrapper">
				<div id="imageBox"></div>
				<div class="flex box">
					<div class="flex onRight ">
						<div id="nextButton" class="button" onclick="javascript:nextImage()"></div>
						<div class="button" onclick="javascript:handleCloseButton()">확인</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			let type, condition, imageList, nextButtonText, imgNo, isChkLast, chkListNo;
			// input 위에 이미지 넣을 지, 텍스트만 넣을 지 타입으로 확인하고 분기

			window.addEventListener("message", (e) => {
				condition =  e.data.condition;
				imageList = IMAGE_FLOW[e.data.dialogId].imageList;
				nextButtonText = IMAGE_FLOW[e.data.dialogId].nextButtonText ? IMAGE_FLOW[e.data.dialogId].nextButtonText : '다음';
				chkListNo = IMAGE_FLOW[e.data.dialogId].chkListNo ? IMAGE_FLOW[e.data.dialogId].chkListNo : -1;

				init();
			});
			
			const setImage = (no) => {
				const IMG = `
					<div class="imageWrapper">
						<img src="${imageList[no]}" alt="hansCardImage"/>
					</div>`;
				document.getElementById('imageBox').innerHTML = IMG;
			}

			const init = () => {
				imgNo = 0;
				isChkLast = false;
				setImage(imgNo);
				if(imageList.length == 1)
					document.getElementById('nextButton').remove();
				else
					document.getElementById('nextButton').innerHTML = nextButtonText;
			}

			const nextImage = () => {
				imgNo += 1;
				if (imgNo == imageList.length - 1)
					isChkLast = true;
				else if (imgNo >= imageList.length)
					imgNo = 0;

				setImage(imgNo);
			}

			const handleCloseButton = () => {
				if (isChkLast && chkListNo != -1)
					window.parent.postMessage({type: "setCheckList", listNo: chkListNo}, "*");
				else {
					window.parent.postMessage({type: "closeDialog"}, "*");
				}
			}

			const IMAGE_FLOW = [
				{	
					chkListNo: 3,
					nextButtonText: '뒤집기',
					imageList: [
						"https://github.com/rlaghdcjf12/ZEP/blob/main/seekHANSout/floor5/assets/hansCardOnToilet.jpg?raw=true",
						"https://github.com/rlaghdcjf12/ZEP/blob/main/seekHANSout/floor5/assets/hansCardMemo1.png?raw=true"]
				},
			]
		</script>
	</body>
</html>
